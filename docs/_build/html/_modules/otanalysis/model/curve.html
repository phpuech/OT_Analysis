<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>otanalysis.model.curve &mdash; OTAnalysis 0.2.72 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> OTAnalysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme_link.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme_link.html#otanalysis">OTAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme_link.html#tool-for-managing-the-results-of-optical-tweezers">Tool for managing the results of optical tweezers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme_link.html#install-miniconda-create-conda-environment">Install MiniConda &amp;&amp; Create conda environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">OTAnalysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OTAnalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>otanalysis.model.curve</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for otanalysis.model.curve</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># @author Thierry GALLIANO</span>
<span class="c1"># @contributors Pierre-Henri PUECH, Laurent LIMOZIN, Guillaume GAY</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">File describing the instance class of the curved objects</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">savgol_filter</span>
<span class="kn">from</span> <span class="nn">.optical_effect</span> <span class="kn">import</span> <span class="n">OpticalEffect</span>


<div class="viewcode-block" id="Curve"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve">[docs]</a><span class="k">class</span> <span class="nc">Curve</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that instantiates curved objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=unbalanced-tuple-unpacking</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">dict_segments</span><span class="p">,</span> <span class="n">pulling_length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization attributes of the object and launch the functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">######### Attributes #################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
        <span class="n">bead</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">couple</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span> <span class="o">=</span> <span class="n">dict_segments</span>  <span class="c1"># Liste d&#39;objets segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bead&#39;</span><span class="p">:</span> <span class="n">bead</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">:</span> <span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;couple&#39;</span><span class="p">:</span> <span class="n">couple</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;treat_supervised&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1">######### methods ###############</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identification_main_axis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalization_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correction_optical_effect_object</span> <span class="o">=</span> <span class="n">OpticalEffect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_incomplete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_retraction_troncated</span><span class="p">(</span>
            <span class="n">pulling_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_incomplete</span><span class="p">:</span>
            <span class="n">baseline_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;baseline_origin_press (N)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span>
                <span class="n">baseline_origin</span> <span class="o">*</span> <span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>
            <span class="n">beseline_corrected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s1">&#39;Press&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;baseline_corrected_press (pN)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span>
                <span class="n">beseline_corrected</span> <span class="o">*</span> <span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>
            <span class="n">std_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_std</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;std_origin_press (N)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">std_origin</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>
            <span class="n">std_corrected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_std</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;std_corrected_press (pN)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span>
                <span class="n">std_corrected</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>

    <span class="c1">################################################################################################</span>
    <span class="c1"># Initialization methods of the curves object:</span>
    <span class="c1">#- identification_main_axis</span>
    <span class="c1">#- curbe_reversal</span>
    <span class="c1">#- normalization_data</span>
    <span class="c1">#- segment_retraction_troncated</span>
    <span class="c1">#- calcul_baseline</span>
    <span class="c1">#- calcul_std</span>
    <span class="c1">#- detected_min_force</span>
    <span class="c1">#- check_alignment_curve</span>
    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.identification_main_axis"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.identification_main_axis">[docs]</a>    <span class="k">def</span> <span class="nf">identification_main_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the main axis of the manipulation.</span>
<span class="sd">        The ball is immobile, it is the cell that we approach the ball along an axis:</span>
<span class="sd">        +X: the cell approaches by the right</span>
<span class="sd">        -X: the cell approaches by the left</span>
<span class="sd">        -Y: the cell comes from the top</span>
<span class="sd">        +Y: the cell comes from the bottom</span>

<span class="sd">        :return:</span>
<span class="sd">            main_axis: str</span>
<span class="sd">                direction related to phi angle with an interval of -pi +/- epsilon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scanner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;header_global&#39;</span><span class="p">][</span><span class="s1">&#39;settings.segment.0.xy-scanner.scanner&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;header_global&#39;</span><span class="p">][</span><span class="s1">&#39;settings.segment.0.direction.phi&#39;</span><span class="p">])</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;main_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scanner</span> <span class="o">==</span> <span class="s1">&#39;sample-scanner&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;-x&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;+x&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">+</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;-y&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">+</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;+y&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;Angle error&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;Error on the scanner&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">main_axis</span><span class="p">)</span></div>

    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.curve_reversal"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.curve_reversal">[docs]</a>    <span class="k">def</span> <span class="nf">curve_reversal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        According to the main axis transforms all values into their inverse to return the curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;curve_reversal&quot;)</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;xSignal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> \
                <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;xSignal1&#39;</span><span class="p">]</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;ySignal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> \
                <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;ySignal1&#39;</span><span class="p">]</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;zSignal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> \
                <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;zSignal1&#39;</span><span class="p">]</span></div>

    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.calcul_baseline"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.calcul_baseline">[docs]</a>    <span class="k">def</span> <span class="nf">calcul_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_segment</span><span class="p">,</span> <span class="n">corrected_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">range_data</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the baseline of the curve by calculating</span>
<span class="sd">        the average over the first or the last 200 points</span>

<span class="sd">        :parameters:</span>
<span class="sd">            name_segment: str</span>
<span class="sd">                name of the segment on which to search the baseline</span>
<span class="sd">        :return:</span>
<span class="sd">            basseline: float</span>
<span class="sd">                value of the baseline as a function of the segment</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">baseline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">axe</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="n">name_segment</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;motion&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">corrected_data</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Press&quot;</span><span class="p">:</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">range_data</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Pull&quot;</span><span class="p">:</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">range_data</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">baseline</span></div>

    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.normalization_data"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.normalization_data">[docs]</a>    <span class="k">def</span> <span class="nf">normalization_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize the data on the main axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;normalization_data&quot;)</span>
        <span class="n">num_segment</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">choice_axe</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">axe</span> <span class="ow">in</span> <span class="n">choice_axe</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span>
            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">column</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e12</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">-</span> \
                <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">num_segment</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">time_start</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="n">time_start</span><span class="p">)</span>
            <span class="n">num_segment</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;calibrations&#39;</span><span class="p">][</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1_stiffness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; N/m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;stiffness (N/m)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">stiffness</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="n">stiffness</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1e12</span><span class="o">/</span><span class="mf">1e9</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;distance&#39;</span> <span class="ow">in</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">distances</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e9</span>
                <span class="n">forces</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
                <span class="n">data_corrected_stiffness</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">-</span> <span class="n">forces</span> <span class="o">/</span> <span class="n">stiffness</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">data_corrected_stiffness</span> <span class="o">-</span> <span class="n">data_corrected_stiffness</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># (nm)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s2">&quot;sign&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curve_reversal</span><span class="p">()</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.segment_retraction_troncated"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.segment_retraction_troncated">[docs]</a>    <span class="k">def</span> <span class="nf">segment_retraction_troncated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulling_length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checking the length of the last segment</span>

<span class="sd">        :parameters:</span>
<span class="sd">            pulling_length: int</span>
<span class="sd">                Percentage of length to accept the curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Pull&#39;</span><span class="p">]</span>
        <span class="n">nb_point_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.num-points&#39;</span><span class="p">])</span>
        <span class="n">size_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">])</span>
        <span class="n">check_segment_troncated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">nb_point_segment</span> <span class="o">==</span> <span class="n">size_data</span><span class="p">:</span>
            <span class="n">check_segment_troncated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nb_point_segment</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">pulling_length</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">size_data</span><span class="p">:</span>
                <span class="n">check_segment_troncated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">check_segment_troncated</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.calcul_std"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.calcul_std">[docs]</a>    <span class="k">def</span> <span class="nf">calcul_std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_segment</span><span class="p">,</span> <span class="n">corrected_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">range_data</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the standard deviation of the curve by calculating</span>
<span class="sd">        over the first or the last 200 points</span>

<span class="sd">        :parameters:</span>
<span class="sd">            name_segment: str</span>
<span class="sd">                name of the segment on which to search the baseline</span>
<span class="sd">            range_data: int</span>
<span class="sd">                nb point for the calcul</span>

<span class="sd">        :return:</span>
<span class="sd">            std: float</span>
<span class="sd">                value of the standard deviation as a function of the segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">axe</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="n">name_segment</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;motion&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">corrected_data</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Press&quot;</span><span class="p">:</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">range_data</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Pull&quot;</span><span class="p">:</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">range_data</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">std</span></div>

    <span class="c1">###################################################################################################</span>

<div class="viewcode-block" id="Curve.detected_min_force"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.detected_min_force">[docs]</a>    <span class="k">def</span> <span class="nf">detected_min_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination on the approach segment of the ball,</span>
<span class="sd">        if the contact between the ball and the cell has been correctly executed</span>

<span class="sd">        :parameters:</span>
<span class="sd">            tolerance: int</span>
<span class="sd">                pourcentage de tolérance pour la force expérimentale</span>

<span class="sd">        :return:</span>
<span class="sd">            contact: bool</span>
<span class="sd">                True if the contact is within the maximum force range</span>
<span class="sd">            data_max: float</span>
<span class="sd">                maximum value of the contact segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;detected_max_force: &quot;</span><span class="p">)</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">data_min_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index_data_min_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">time_min_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index_data_max_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">force_max_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">data_min_curve</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]:</span>
                <span class="n">time_min_curve</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">data_min_curve</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">index_data_min_curve</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">force_max_curve</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]:</span>
                <span class="n">force_max_curve</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
                <span class="n">index_data_max_curve</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
        <span class="n">data_min_approach</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index_data_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s2">&quot;Press&quot;</span><span class="p">]</span>
        <span class="n">force</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s2">&quot;segment-settings.setpoint.value&quot;</span><span class="p">])</span>
        <span class="n">force</span> <span class="o">=</span> <span class="o">-</span><span class="n">force</span> <span class="o">*</span> <span class="mf">1e12</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">force</span> <span class="o">*</span> <span class="n">tolerance</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">data_min_approach</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="n">data_min_approach</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="n">tolerance</span><span class="p">):</span>
            <span class="n">index_data_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="c1"># else:</span>
        <span class="c1">#     for index_data in range(0, len(data), 1):</span>
        <span class="c1">#         if (force - interval) &gt; data[index_data] &gt; (force + interval):</span>
        <span class="c1">#             if data[index_data] &lt; data_min_approach:</span>
        <span class="c1">#                 data_min_approach = data[index_data]</span>
        <span class="c1">#                 index_data_min = index_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;force_min_press&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_data_min</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">data_min_approach</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;force_min_curve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_data_min_curve</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">data_min_curve</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;time_min_curve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_data_min_curve</span><span class="p">,</span> <span class="s1">&#39;value (s)&#39;</span><span class="p">:</span> <span class="n">time_min_curve</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;force_max_curve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_data_max_curve</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_max_curve</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">data_min_curve</span></div>

    <span class="c1">###################################################################################################</span>

<div class="viewcode-block" id="Curve.check_alignment_curve"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.check_alignment_curve">[docs]</a>    <span class="k">def</span> <span class="nf">check_alignment_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold_align</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the curve well aligned on the main axis</span>

<span class="sd">        :parameters:</span>
<span class="sd">            force: float</span>
<span class="sd">                application force on the cell (Default: 10e-12)</span>
<span class="sd">        :return:</span>
<span class="sd">            check: bool</span>
<span class="sd">                return True if the curve is not well aligned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;check_alignment_curve&quot;)</span>
        <span class="n">force_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">force_min_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected_min_force</span><span class="p">()</span>
        <span class="n">force_min_exp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">force_min_exp</span> <span class="o">*</span> <span class="p">(</span><span class="n">threshold_align</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s2">&quot;Press&quot;</span><span class="p">]</span>
        <span class="n">force_threshold</span> <span class="o">=</span> <span class="n">threshold_align</span> <span class="o">*</span> \
            <span class="nb">float</span><span class="p">(</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.setpoint.value&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="n">force_threshold</span> <span class="o">=</span> <span class="n">force_threshold</span> <span class="o">*</span> <span class="mf">1e12</span>
        <span class="k">if</span> <span class="n">force_threshold</span> <span class="o">&lt;</span> <span class="n">force_min_exp</span><span class="p">:</span>
            <span class="n">force_min</span> <span class="o">=</span> <span class="n">force_min_exp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">force_min</span> <span class="o">=</span> <span class="n">force_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;threshold alignement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">force_min</span>
        <span class="n">dict_align</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dict_align</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">check_alignment</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">],</span> <span class="n">force_min</span><span class="p">)</span>
        <span class="n">dict_align_final</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_align</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;AL&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_align_final</span><span class="p">:</span>
                <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span>
                <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span>
                        <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NaN&#39;</span><span class="p">:</span>
                    <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_align_final</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]):</span>
                        <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dict_align_final</span></div>

    <span class="c1">###################################################################################################</span>

<div class="viewcode-block" id="Curve.compare_baseline_start_end"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.compare_baseline_start_end">[docs]</a>    <span class="k">def</span> <span class="nf">compare_baseline_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comparison of the beginning and the end of the curve to know</span>
<span class="sd">        if there is a break of adhesion and return to normal</span>

<span class="sd">        :return:</span>
<span class="sd">            :check: bool</span>
<span class="sd">                returns true if start and end similarly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compare_baseline&quot;</span><span class="p">)</span>
        <span class="n">type_curve</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">baseline_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;baseline_corrected_press (pN)&#39;</span><span class="p">])</span>
        <span class="n">line_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s2">&quot;Pull&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">std_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;std_corrected_press (pN)&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">baseline_start</span> <span class="o">-</span> <span class="n">std_start</span><span class="o">*</span><span class="n">tolerance</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">line_end</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">baseline_start</span> <span class="o">+</span> <span class="n">std_start</span><span class="o">*</span><span class="n">tolerance</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">baseline_end Ok</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;baseline_end Ok&quot;</span><span class="p">)</span>
            <span class="n">type_curve</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1">#self.features[&quot;automatic_type&quot;] = None</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">baseline_start</span> <span class="o">+</span> <span class="n">std_start</span><span class="o">*</span><span class="n">tolerance</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">line_end</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Baseline_end NO</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Baseline_end NO&quot;</span><span class="p">)</span>
            <span class="n">type_curve</span> <span class="o">=</span> <span class="s2">&quot;ITU&quot;</span>
            <span class="c1">#self.features[&quot;automatic_type&quot;] = &quot;ITU&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Baseline_end NO</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Baseline_end NO&quot;</span><span class="p">)</span>
            <span class="n">type_curve</span> <span class="o">=</span> <span class="s2">&quot;RE&quot;</span>
            <span class="c1">#self.features[&quot;automatic_type&quot;] = &quot;RE&quot;</span>

        <span class="k">return</span> <span class="n">type_curve</span></div>

    <span class="c1">###############################################################################################</span>
        <span class="c1"># Methods common to all segments</span>
    <span class="c1">###############################################################################################</span>
<div class="viewcode-block" id="Curve.smooth"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.smooth">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span> <span class="n">order_polynome</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows to reduce the noise on the whole curve</span>

<span class="sd">        :parameters:</span>
<span class="sd">            force_data: Series</span>
<span class="sd">                values of y</span>
<span class="sd">            window_length: int (odd)</span>
<span class="sd">                size of the sliding window</span>

<span class="sd">        :return:</span>
<span class="sd">            values of y smoothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">window_length</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">window_length</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="n">window_length</span><span class="p">,</span> <span class="n">order_polynome</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y_smooth</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.retrieve_contact"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.retrieve_contact">[docs]</a>    <span class="k">def</span> <span class="nf">retrieve_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_analyze</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows to determine the contact point of the ball with the cell and contact release cell</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;retrieve_contact&#39;</span><span class="p">)</span>
        <span class="n">list_index_contact</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index_contact</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;baseline_corrected_press (pN)&#39;</span><span class="p">])</span>
        <span class="n">std</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;std_corrected_press (pN)&#39;</span><span class="p">])</span>
        <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">),</span> <span class="n">std</span><span class="o">*</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">baseline</span> <span class="o">-</span> <span class="n">std</span> <span class="o">&lt;</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">std</span><span class="p">):</span>
                <span class="n">list_index_contact</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_index_contact</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">segment</span> <span class="o">==</span> <span class="s2">&quot;Press&quot;</span><span class="p">:</span>
                <span class="n">index_contact</span> <span class="o">=</span> <span class="n">list_index_contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index_contact</span> <span class="o">=</span> <span class="n">list_index_contact</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">index_contact</span><span class="p">,</span> <span class="n">line_pos_threshold</span></div>

    <span class="c1">###############################################################################################</span>
        <span class="c1"># Analysis methods segment Approach</span>
    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.fit_model_approach"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.fit_model_approach">[docs]</a>    <span class="k">def</span> <span class="nf">fit_model_approach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_corrected_stiffness</span><span class="p">,</span> <span class="n">contact_point</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">baseline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination contact model between the bead and the cell</span>

<span class="sd">        :parameters:</span>
<span class="sd">            model: str</span>
<span class="sd">                model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_corrected_stiffness</span><span class="p">)</span>
        <span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&lt;</span> <span class="n">contact_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&gt;</span> <span class="n">contact_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&gt;</span> <span class="n">contact_point</span><span class="p">]</span><span class="o">-</span><span class="n">contact_point</span><span class="p">)</span> <span class="o">+</span> <span class="n">baseline</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sphere&quot;</span><span class="p">:</span>
            <span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&gt;</span> <span class="n">contact_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&gt;</span> <span class="n">contact_point</span><span class="p">]</span><span class="o">-</span><span class="n">contact_point</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">baseline</span>
        <span class="k">return</span> <span class="n">fit</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.fit_curve_approach"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.fit_curve_approach">[docs]</a>    <span class="k">def</span> <span class="nf">fit_curve_approach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">window_smooth</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creation of the data fit for the curve</span>

<span class="sd">        :parameters:</span>
<span class="sd">            tolerance: noise threshold in number of times the standard deviation</span>

<span class="sd">        :return:</span>
<span class="sd">            f_parameters: fit parameters describing the model</span>
<span class="sd">            fitted: force data corresponding to the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fit_curve_approach&#39;</span><span class="p">)</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s2">&quot;Press&quot;</span><span class="p">]</span>
        <span class="n">force_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="n">window_smooth</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># if &#39;distance&#39; in segment.corrected_data:</span>
        <span class="c1">#     distance_data = np.abs(segment.corrected_data[&#39;distance&#39;])</span>
        <span class="n">time_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span>
        <span class="c1">#self.graphics[&#39;y_smooth_Press&#39;] = y_smooth</span>
        <span class="n">index_contact</span><span class="p">,</span> <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_contact</span><span class="p">(</span>
            <span class="n">y_smooth</span><span class="p">,</span> <span class="s2">&quot;Press&quot;</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;threshold_press&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_pos_threshold</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;baseline_corrected_press (pN)&#39;</span><span class="p">])</span>  <span class="c1"># y0</span>
        <span class="n">x_1</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">time_data</span><span class="p">)</span><span class="o">-</span><span class="n">index_contact</span><span class="p">]</span>
        <span class="n">y_1</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="n">index_contact</span><span class="p">]</span>
        <span class="n">x_2</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">time_data</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">y_2</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_2</span> <span class="o">-</span> <span class="n">y_1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_2</span> <span class="o">-</span> <span class="n">x_1</span><span class="p">)</span>
        <span class="n">contact_point</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index_contact</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># x0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;contact_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_contact</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_contact</span><span class="p">]}</span>
        <span class="c1">#initial_guesses_accuracy = [10**(9), 10**3, 1]</span>
        <span class="n">initial_guesses_accuracy</span> <span class="o">=</span> <span class="p">[</span><span class="n">contact_point</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">baseline</span><span class="p">]</span>
        <span class="n">f_parameters</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_model_approach</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">,</span> <span class="n">initial_guesses_accuracy</span><span class="p">)</span>
        <span class="c1">#self.message += str(f_parameters)</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model_approach</span><span class="p">(</span>
            <span class="n">time_data</span><span class="p">,</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;fitted_Press&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitted</span>

        <span class="k">return</span> <span class="n">f_parameters</span></div>

    <span class="c1">###############################################################################################</span>
<div class="viewcode-block" id="Curve.determine_young_modulus"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.determine_young_modulus">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">determine_young_modulus</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">bead_ray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Young modulus calculation</span>

<span class="sd">        :parameters:</span>
<span class="sd">            k: float</span>
<span class="sd">                directing coefficient of the slope</span>
<span class="sd">            eta: float</span>
<span class="sd">                compressibility constant</span>
<span class="sd">            bead_ray: float</span>
<span class="sd">                size of the ball radius</span>

<span class="sd">        :return:</span>
<span class="sd">            young:float</span>
<span class="sd">                young module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indentation_depth</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># la profondeur d&#39;indentation (m)</span>
        <span class="c1"># eta = ratio de Poisson (adimensionnel)</span>
        <span class="n">young</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bead_ray</span> <span class="o">*</span> <span class="n">indentation_depth</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># radius in nm</span>
        <span class="k">return</span> <span class="n">young</span></div>

    <span class="c1">###############################################################################################</span>
<div class="viewcode-block" id="Curve.curve_approach_analyze"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.curve_approach_analyze">[docs]</a>    <span class="k">def</span> <span class="nf">curve_approach_analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows you to calculate the error and Young&#39;s modulus if the model is spherical</span>

<span class="sd">        :parameters:</span>
<span class="sd">            methods: dict</span>
<span class="sd">                dictionary with all the parameters entered by the user that condition the analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">young</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">error_young</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#error_contact = None</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">f_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_curve_approach</span><span class="p">(</span>
            <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;factor_noise&#39;</span><span class="p">],</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;width_window_smooth&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;slope (pN/nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="s1">&#39;.2E&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">error_young</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;error (pN/nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">error_young</span><span class="p">,</span> <span class="s1">&#39;.2E&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;error (pN/nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_young</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Slope (pN/nm) = &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; +/-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Slope (pN/nm) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span>
                  <span class="s2">&quot; +/-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sphere&#39;</span><span class="p">:</span>
            <span class="n">young</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">determine_young_modulus</span><span class="p">(</span>
                <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">],</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;bead_radius&#39;</span><span class="p">])</span>
            <span class="n">error_young</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">determine_young_modulus</span><span class="p">(</span>
                <span class="n">error</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">],</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;bead_radius&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">young</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">young</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">error_young</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;young (Pa)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">young</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;error young (Pa)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_young</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Young modulus (Pa) = &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">young</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; +/-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Young modulus (Pa) = &quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">young</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; +/- &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Model error&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Trace not processed&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model error&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trace not processed&quot;</span><span class="p">)</span>

        <span class="n">length_segment</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.length&#39;</span><span class="p">])</span>
        <span class="n">time_segment</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">])</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">length_segment</span><span class="o">/</span><span class="n">time_segment</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span></div>

    <span class="c1">###############################################################################################</span>
        <span class="c1"># Analysis methods segment Return</span>
    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.retrieve_retour_line_end"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.retrieve_retour_line_end">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">retrieve_retour_line_end</span><span class="p">(</span><span class="n">curve_object</span><span class="p">,</span> <span class="n">data_analyze</span><span class="p">,</span> <span class="n">line_pos_threshold</span><span class="p">,</span> <span class="n">type_curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determining the point of return to the baseline in the &quot;Pull&quot; segment</span>

<span class="sd">        :parameters:</span>
<span class="sd">            data_analyse: np.array</span>
<span class="sd">                smooth data curve for research</span>
<span class="sd">            line_pos_threshold: float</span>
<span class="sd">                threshold value for return to baseline</span>
<span class="sd">            type_curve: str</span>
<span class="sd">                classification of the curve at the time of analysis</span>
<span class="sd">        :return:</span>
<span class="sd">            index_return_endline: int</span>
<span class="sd">                index of the return point to the baseline</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_return_endline</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">type_curve</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_data_return_endline</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">data_analyze</span><span class="o">.</span><span class="n">argmax</span><span class="p">():]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">list_data_return_endline</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span>
                <span class="n">data</span> <span class="o">&lt;</span> <span class="n">line_pos_threshold</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">list_data_return_endline</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index_return_endline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">data_analyze</span> <span class="o">==</span> <span class="n">list_data_return_endline</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">index_return_endline</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">):</span>
                    <span class="n">index_return_endline</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">index_return_endline</span></div>

    <span class="c1">################################################################################################</span>
<div class="viewcode-block" id="Curve.fit_model_retraction"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.fit_model_retraction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_model_retraction</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">point_release</span><span class="p">,</span> <span class="n">endline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function to model the fitting of the &quot;Pull&quot; segment</span>

<span class="sd">        :parameters:</span>
<span class="sd">            data: list</span>
<span class="sd">                time data of the &quot;Pull&quot; segment of the curve to make the fit</span>
<span class="sd">            k: float</span>
<span class="sd">                guess of the expected slope direction coefficient</span>
<span class="sd">            point_release: float</span>
<span class="sd">                time value where the change of slope must occur</span>
<span class="sd">            enline: float</span>
<span class="sd">                force value for the end line</span>
<span class="sd">        :return:</span>
<span class="sd">            fit: list</span>
<span class="sd">                list of force values calculated by the fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&lt;</span> <span class="n">point_release</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&lt;</span> <span class="n">point_release</span><span class="p">]</span><span class="o">-</span><span class="n">point_release</span><span class="p">)</span> <span class="o">+</span> <span class="n">endline</span>
        <span class="n">fit</span><span class="p">[</span><span class="n">fit</span> <span class="o">&gt;=</span> <span class="n">point_release</span><span class="p">]</span> <span class="o">=</span> <span class="n">endline</span>
        <span class="k">return</span> <span class="n">fit</span></div>
    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.derivation"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.derivation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">derivation</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function allowing to return the derivative of vector transmitted according to an interval </span>
<span class="sd">        for each point (n being the point we take from n/2 before and n/2 after)</span>

<span class="sd">        :parameters:</span>
<span class="sd">            force_data: list(np.array)</span>
<span class="sd">                force vector</span>
<span class="sd">            time_data: list(np.array)</span>
<span class="sd">                time vector</span>
<span class="sd">            n: int</span>
<span class="sd">                interval for each point</span>

<span class="sd">        :return:</span>
<span class="sd">            derivation: list(np.array)</span>
<span class="sd">                vector of the derivative for the force data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">derivation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">derivation</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">force_data</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
                <span class="n">time_data</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="mi">2</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">derivation</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">derivation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">derivation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">derivation</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">derivation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">derivation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">derivation</span></div>
    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.search_transition_point"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.search_transition_point">[docs]</a>    <span class="k">def</span> <span class="nf">search_transition_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">force_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for the transition point when it is detectable</span>

<span class="sd">        :parameters:</span>
<span class="sd">            time_data: list(np.array)</span>
<span class="sd">                vector time</span>
<span class="sd">            force_data: list(np_array)</span>
<span class="sd">                vector force</span>

<span class="sd">        :return:</span>
<span class="sd">            derive_smooth: list(np.array)</span>
<span class="sd">                derivative of the force on the chosen interval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">]</span>
        <span class="n">derive_smooth</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">derivation</span><span class="p">(</span><span class="n">y_smooth</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">index_transition_point</span> <span class="o">=</span> <span class="n">derive_smooth</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">index_transition_point</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_transition_point</span><span class="p">,</span> <span class="s1">&#39;value (pN)&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_transition_point</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;value (pN)&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">derive_smooth</span></div>

    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.curve_return_analyze"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.curve_return_analyze">[docs]</a>    <span class="k">def</span> <span class="nf">curve_return_analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">type_curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analysis of the &quot;Pull&quot; segment of the curve with determination of representative points for classification</span>

<span class="sd">        :parameters:</span>
<span class="sd">            methods: dict</span>
<span class="sd">                dictionary with all the parameters entered by the user that condition the analysis</span>
<span class="sd">            type_curve: str</span>
<span class="sd">                classification of the curve at the time of analysis</span>
<span class="sd">        :return:</span>
<span class="sd">            type_curve: str</span>
<span class="sd">                classification of the curve at the time of analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">###### data ###############</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Pull&#39;</span><span class="p">]</span>
        <span class="n">force_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">]</span>
                                            <span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;width_window_smooth&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_smooth</span>
        <span class="n">time_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>

        <span class="c1">######## calcul release #########</span>
        <span class="n">index_release</span><span class="p">,</span> <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_contact</span><span class="p">(</span>
            <span class="n">y_smooth</span><span class="p">,</span> <span class="s2">&quot;Pull&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;factor_noise&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;threshold_pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_pos_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_release</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]}</span>

        <span class="c1">################## calcul guess and fit ################</span>
        <span class="c1">###### guess  ########</span>
        <span class="k">if</span> <span class="n">index_release</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">x_1</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span>
            <span class="n">y_1</span> <span class="o">=</span> <span class="n">y_smooth</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_1</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
            <span class="n">y_1</span> <span class="o">=</span> <span class="n">y_smooth</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">index_release</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">x_2</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
            <span class="n">y_2</span> <span class="o">=</span> <span class="n">y_smooth</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_2</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_2</span> <span class="o">=</span> <span class="n">y_smooth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_1</span> <span class="o">-</span> <span class="n">y_2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_1</span> <span class="o">-</span> <span class="n">x_2</span><span class="p">)</span>
        <span class="n">point_release</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span>  <span class="c1"># x0</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;baseline_corrected_press (pN)&#39;</span><span class="p">])</span>
        <span class="c1"># initial_guess = [10**(9), point_release, 10**3]</span>
        <span class="n">initial_guesses_accuracy</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">point_release</span><span class="p">,</span> <span class="n">baseline</span><span class="p">]</span>
        <span class="c1">######## fit #########</span>
        <span class="n">f_parameters</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
            <span class="n">Curve</span><span class="o">.</span><span class="n">fit_model_retraction</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">,</span> <span class="n">initial_guesses_accuracy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Pente (pN/nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">fit_model_retraction</span><span class="p">(</span>
            <span class="n">time_data</span><span class="p">,</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;fitted_Pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitted</span>

        <span class="c1">############## calcul return point and transition point ######################</span>
        <span class="n">index_return_endline</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">retrieve_retour_line_end</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">,</span> <span class="n">line_pos_threshold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">type_curve</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index_return_endline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#index_transition = index_return_endline - 20</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_return_endline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_return_endline</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">y_smooth</span><span class="p">[</span><span class="n">index_return_endline</span><span class="p">]}</span>
            <span class="c1"># self.features[&#39;point_transition&#39;] = {</span>
            <span class="c1">#             &#39;index&#39;: index_transition, &#39;value (pN)&#39;: y_smooth[index_transition]}</span>
            <span class="n">derive_smooth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_transition_point</span><span class="p">(</span><span class="n">time_data</span><span class="p">,</span> <span class="n">force_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_return_endline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;value (pN)&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">}</span>

        <span class="n">type_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">type_curve</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">type_curve</span></div>

    <span class="c1">################################################################################################</span>
<div class="viewcode-block" id="Curve.fit_linear_classification"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.fit_linear_classification">[docs]</a>    <span class="k">def</span> <span class="nf">fit_linear_classification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_start</span><span class="p">,</span> <span class="n">index_end</span><span class="p">,</span> <span class="n">name_fit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows classification based on the shape of the fit line between two selected zones (max and transition point)</span>

<span class="sd">        :parameters:</span>
<span class="sd">            distance_data: list</span>
<span class="sd">                distance value of the &quot;Pull&quot; segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Pull&#39;</span><span class="p">]</span>
        <span class="n">y_smooth_pull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">]</span>
        <span class="n">distance_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;distance&#39;</span> <span class="ow">in</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">:</span>
            <span class="n">distance_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">])</span>
        <span class="n">f_parameters</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
            <span class="n">Curve</span><span class="o">.</span><span class="n">linear_fit</span><span class="p">,</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_start</span><span class="p">:</span><span class="n">index_end</span><span class="p">],</span> <span class="n">y_smooth_pull</span><span class="p">[</span><span class="n">index_start</span><span class="p">:</span><span class="n">index_end</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;slope_&quot;</span> <span class="o">+</span> <span class="n">name_fit</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fitted_classification</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">linear_fit</span><span class="p">(</span>
            <span class="n">distance_data</span><span class="p">[</span><span class="n">index_start</span><span class="p">:</span><span class="n">index_end</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="n">name_fit</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitted_classification</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;distance_&#39;</span> <span class="o">+</span>
                      <span class="n">name_fit</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_start</span><span class="p">:</span><span class="n">index_end</span><span class="p">]</span></div>

    <span class="c1">###########################################################################################################################</span>

<div class="viewcode-block" id="Curve.classification"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.classification">[docs]</a>    <span class="k">def</span> <span class="nf">classification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">type_curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        classification of curves not yet classified as ITU or RE </span>
<span class="sd">        - NAD if max force &lt; max defined force (pN)</span>
<span class="sd">        - AD if nb of points (force_max-return_endline) &lt; nb of points defined in the interface </span>
<span class="sd">        and distance (force_max-return_endline) &lt; defined distance</span>
<span class="sd">        - FTU otherwise</span>

<span class="sd">        :parameters:</span>
<span class="sd">            methods: dict</span>
<span class="sd">                dictionary of parameters defined in the first interface for launching the analysis</span>
<span class="sd">            type_curve: str</span>
<span class="sd">                classification of the curve. None by default</span>

<span class="sd">        :return:</span>
<span class="sd">            type_curve: str</span>
<span class="sd">                classification given to the curve during this analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">########### data ############</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Pull&#39;</span><span class="p">]</span>
        <span class="n">force_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">]</span>
                                            <span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">distance_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;distance&#39;</span> <span class="ow">in</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">:</span>
            <span class="n">distance_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">])</span>
        <span class="n">time_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>

        <span class="c1">############ points characteristics ##################</span>
        <span class="n">index_release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_release&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
        <span class="n">index_return_endline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_return_endline&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">items</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;fitted_classification&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">items</span><span class="p">(</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;distance_fitted_classification&#39;</span><span class="p">)])</span>

        <span class="c1">############## classification NAD, AD, FTU ##################</span>
        <span class="k">if</span> <span class="n">type_curve</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index_force_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">][</span><span class="n">index_release</span><span class="p">:</span><span class="n">index_release</span><span class="o">+</span><span class="mi">1500</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;force_max_curve&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;jump_force&#39;</span><span class="p">]:</span>
                <span class="n">type_curve</span> <span class="o">=</span> <span class="s1">&#39;NAD&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">index_return_endline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index_return_endline</span> <span class="o">!=</span> <span class="s1">&#39;NaN&#39;</span><span class="p">:</span>
                    <span class="c1"># if index_release &lt; index_return_endline:</span>
                    <span class="c1">#     index_force_max = self.graphics[&#39;y_smooth_Pull&#39;][index_release:index_return_endline].argmax()</span>
                    <span class="c1"># elif index_release &gt; index_return_endline:</span>
                    <span class="c1">#     index_force_max = self.graphics[&#39;y_smooth_Pull&#39;][index_return_endline:index_release].argmax()</span>
                    <span class="c1"># else:</span>
                    <span class="n">index_force_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;force_max_curve&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
                    <span class="c1">##################### calcul jump ########################</span>
                    <span class="n">jump_force_start_pull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span> <span class="o">-</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">][</span><span class="n">index_release</span><span class="p">]</span>
                    <span class="n">jump_nb_points_start</span> <span class="o">=</span> <span class="n">index_force_max</span> <span class="o">-</span> <span class="n">index_release</span>
                    <span class="n">jump_nb_points_end</span> <span class="o">=</span> <span class="n">index_return_endline</span> <span class="o">-</span> <span class="n">index_force_max</span>

                    <span class="n">jump_force_end_pull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span> <span class="o">-</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">][</span><span class="n">index_return_endline</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_force_start_pull (pN)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_force_start_pull</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_force_end_pull (pN)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_force_end_pull</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_nb_points_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_nb_points_start</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_nb_points_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_nb_points_end</span>

                    <span class="n">jump_time_start_pull</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span> <span class="o">-</span> \
                        <span class="n">time_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span>
                    <span class="n">jump_time_end_pull</span> <span class="o">=</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index_return_endline</span><span class="p">]</span> <span class="o">-</span> \
                        <span class="n">time_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_time_start_pull (s)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_time_start_pull</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_time_end_pull (s)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_time_end_pull</span>

                    <span class="n">jump_distance_start_pull</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">jump_distance_end_pull</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">if</span> <span class="n">distance_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">jump_distance_start_pull</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span> <span class="o">-</span> \
                            <span class="n">distance_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span>

                        <span class="n">jump_distance_end_pull</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_return_endline</span><span class="p">]</span> <span class="o">-</span> \
                            <span class="n">distance_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_distance_start_pull (nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_distance_start_pull</span>
                        <span class="c1">###################### fit linear for classification #############################</span>
                        <span class="c1">###### fit max ######</span>
                        <span class="n">jump_nb_points_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_nb_points_start&#39;</span><span class="p">]</span><span class="o">//</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">y_smooth_pull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">]</span>
                        <span class="n">index_start</span> <span class="o">=</span> <span class="n">y_smooth_pull</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span><span class="o">-</span><span class="n">jump_nb_points_start</span>
                        <span class="n">index_end</span> <span class="o">=</span> <span class="n">y_smooth_pull</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_classification</span><span class="p">(</span>
                            <span class="n">index_start</span><span class="p">,</span> <span class="n">index_end</span><span class="p">,</span> <span class="s2">&quot;fitted_classification_max&quot;</span><span class="p">)</span>

                        <span class="c1">###### fit release #####transition_point#</span>
                        <span class="n">index_start</span> <span class="o">=</span> <span class="n">index_release</span>
                        <span class="n">index_end</span> <span class="o">=</span> <span class="n">index_release</span><span class="o">+</span><span class="n">jump_nb_points_start</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_classification</span><span class="p">(</span>
                            <span class="n">index_start</span><span class="p">,</span> <span class="n">index_end</span><span class="p">,</span> <span class="s2">&quot;fitted_classification_release&quot;</span><span class="p">)</span>

                        <span class="c1">####### fit max transition ####</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NaN&#39;</span><span class="p">:</span>
                            <span class="n">index_start</span> <span class="o">=</span> <span class="n">y_smooth_pull</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span>
                            <span class="n">index_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">index_start</span> <span class="o">&lt;</span> <span class="n">index_end</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_classification</span><span class="p">(</span>
                                    <span class="n">index_start</span><span class="p">,</span> <span class="n">index_end</span><span class="p">,</span> <span class="s2">&quot;fitted_classification_max_transition&quot;</span><span class="p">)</span>

                        <span class="c1">###### fit return  endline #######</span>
                        <span class="n">jump_nb_point_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_nb_points_end&#39;</span><span class="p">]</span><span class="o">//</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">index_start</span> <span class="o">=</span> <span class="n">index_return_endline</span> <span class="o">-</span> <span class="n">jump_nb_point_end</span>
                        <span class="n">index_end</span> <span class="o">=</span> <span class="n">index_return_endline</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_classification</span><span class="p">(</span>
                            <span class="n">index_start</span><span class="p">,</span> <span class="n">index_end</span><span class="p">,</span> <span class="s2">&quot;fitted_classification_return_endline&quot;</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.length&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span>
                            <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">])</span>
                        <span class="n">jump_distance_end_pull</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">speed</span><span class="o">*</span><span class="mf">1e9</span><span class="p">)</span> <span class="o">*</span> <span class="n">jump_time_end_pull</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_distance_end_pull (nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_distance_end_pull</span>
                    
                    <span class="c1">############### determination AD ou FTU ###############</span>
                    <span class="k">if</span> <span class="n">jump_nb_points_end</span> <span class="o">&lt;</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;jump_point&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">jump_distance_end_pull</span> <span class="o">&lt;</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;jump_distance&#39;</span><span class="p">]:</span>
                        <span class="n">type_curve</span> <span class="o">=</span> <span class="s1">&#39;AD&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">type_curve</span> <span class="o">=</span> <span class="s1">&#39;FTU&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_force_max</span> <span class="o">=</span> <span class="n">force_data</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">type_curve</span> <span class="o">==</span> <span class="s2">&quot;ITU&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>
                <span class="n">index_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2000</span>
                <span class="n">index_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_classification</span><span class="p">(</span>
                                <span class="n">index_start</span><span class="p">,</span> <span class="n">index_end</span><span class="p">,</span> <span class="s2">&quot;fitted_classification_max_transition&quot;</span><span class="p">)</span>
                
                <span class="n">jump_distance_end_pull</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]]</span> <span class="o">-</span> \
                            <span class="n">distance_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span>
                <span class="n">jump_force_end_pull</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]:</span>
                    <span class="n">jump_force_end_pull</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span> <span class="o">-</span> \
                        <span class="n">force_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">jump_force_end_pull</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]]</span> <span class="o">-</span> \
                        <span class="n">force_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_distance_end_pull (nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_distance_end_pull</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_force_end_pull (pN)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_force_end_pull</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;force_max_pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_force_max</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]}</span>
            

        <span class="k">return</span> <span class="n">type_curve</span></div>

    <span class="c1">##################################################################################################</span>

<div class="viewcode-block" id="Curve.linear_fit"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.linear_fit">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">linear_fit</span><span class="p">(</span><span class="n">time_data</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit model to determine the slope between the maximum point of the curve and the transition point</span>

<span class="sd">        :parameters:</span>
<span class="sd">            time_data: list</span>
<span class="sd">                time data on the selected segment</span>
<span class="sd">            slope: float</span>
<span class="sd">                value of the directing coefficient of the line</span>
<span class="sd">            offset: float</span>
<span class="sd">                value of the expected intercept</span>
<span class="sd">        :return:</span>
<span class="sd">            y-value of the fit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">slope</span><span class="o">*</span><span class="n">time_data</span> <span class="o">+</span> <span class="n">offset</span></div>

    <span class="c1">################################################################################################</span>
        <span class="c1"># Launching methods of analysis of the segments of the curve</span>
    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.analyzed_curve"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.analyzed_curve">[docs]</a>    <span class="k">def</span> <span class="nf">analyzed_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">manual_correction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        launch of the important steps of the analysis of the characteristic elements for a curve</span>

<span class="sd">        :parameters:</span>
<span class="sd">            methods:dictionary with all the parameters provided by the user for the analysis</span>
<span class="sd">            correction: change from the initial correction mode requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">optical_state</span> <span class="o">=</span> <span class="s2">&quot;No_correction&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detected_min_force</span><span class="p">()</span>
        <span class="n">type_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_baseline_start_end</span><span class="p">(</span><span class="n">methods</span><span class="p">[</span><span class="s1">&#39;factor_noise&#39;</span><span class="p">])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">manual_correction</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;optical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Correction&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">correction_optical_effect_object</span><span class="o">.</span><span class="n">automatic_correction</span><span class="p">(</span>
                        <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;factor_noise&#39;</span><span class="p">])</span>
                    <span class="n">optical_state</span> <span class="o">=</span> <span class="s2">&quot;Auto_correction&quot;</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;###########################################&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(())</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;index error No correction&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;###########################################&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curve_approach_analyze</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="n">type_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve_return_analyze</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">type_curve</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;factor_noise&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;optical_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optical_state</span>
        <span class="k">if</span> <span class="n">type_curve</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">type_curve</span> <span class="o">=</span> <span class="s1">&#39;RE&#39;</span>
        <span class="k">if</span> <span class="n">manual_correction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_curve</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;automatic_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_curve</span>
        <span class="k">if</span> <span class="n">type_curve</span> <span class="o">==</span> <span class="s2">&quot;NAD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_return_endline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;transition_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">error</span></div>

    <span class="c1">###############################################################################################</span>
        <span class="c1"># Methods used in the supervision of the interface</span>
    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.retrieve_data_curve"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.retrieve_data_curve">[docs]</a>    <span class="k">def</span> <span class="nf">retrieve_data_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_data</span><span class="o">=</span><span class="s2">&quot;data_original&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualization of the curves on the three axes with Matplotlib</span>

<span class="sd">        :parameters:</span>
<span class="sd">            type_data: str</span>
<span class="sd">                Determined the dataframe to be used for visualization</span>
<span class="sd">                (original data or corrected data)</span>
<span class="sd">            y: str</span>
<span class="sd">                data on the axe Y for the plot</span>
<span class="sd">        :return:</span>
<span class="sd">            plot show</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;data_original&quot;</span><span class="p">:</span>
                <span class="n">data_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">data_total</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">data_total</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data_total</span></div>

    <span class="c1">###################################################################################################</span>

<div class="viewcode-block" id="Curve.add_feature"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.add_feature">[docs]</a>    <span class="k">def</span> <span class="nf">add_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_key</span><span class="p">,</span> <span class="n">add_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adding features to our &quot;features&quot; dictionary</span>

<span class="sd">        :parameters:</span>
<span class="sd">            add_key:str</span>
<span class="sd">                name of the key to add</span>
<span class="sd">            add_value: str, int, dict, list</span>
<span class="sd">                data structure to add as value to the key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">add_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_value</span></div>

    <span class="c1">###################################################################################################</span>
        <span class="c1"># Method of creating the output</span>
    <span class="c1">##################################################################################################</span>

<div class="viewcode-block" id="Curve.creation_output_curve"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.creation_output_curve">[docs]</a>    <span class="k">def</span> <span class="nf">creation_output_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creation of the output dataframe of each curve</span>
<span class="sd">        Recovery and transformations of the dataframe &quot;features&quot; of the curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key_features</span><span class="p">,</span> <span class="n">value_features</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_features</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key_dict</span><span class="p">,</span> <span class="n">value_dict</span> <span class="ow">in</span> <span class="n">value_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key_dict</span> <span class="ow">in</span> <span class="p">(</span><span class="n">key_features</span><span class="p">,</span> <span class="n">key_features</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="n">key_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="n">key_features</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">key_dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="n">key_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_features</span>
        <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;Hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_contact_force (N)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;header_global&#39;</span><span class="p">][</span><span class="s1">&#39;settings.segment.0.setpoint.value&#39;</span><span class="p">]),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span>
        <span class="n">time_segment_pause</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pause&#39;</span><span class="p">:</span>
                <span class="n">time_segment_pause</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;time_segment_pause_&#39;</span> <span class="o">+</span>
                            <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (s)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_segment_pause</span>
            <span class="k">elif</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;motion&#39;</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.length&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_distance_&#39;</span> <span class="o">+</span> <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span>
                            <span class="s1">&#39; (m)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.num-points&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span>
                    <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">]),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_freq_&#39;</span> <span class="o">+</span> <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (Hz)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.length&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span>
                    <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">]),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_speed_&#39;</span> <span class="o">+</span>
                            <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (m/s)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span></div>

    <span class="c1">##################################################################################################</span>
                <span class="c1"># Other methods or test methods</span>
    <span class="c1">##################################################################################################</span>

    <span class="c1"># def derivation(self, force_data, time_data, n):</span>
    <span class="c1">#     derivation = []</span>
    <span class="c1">#     for index in range(n//2, len(force_data)-n//2, 1):</span>
    <span class="c1">#         derivation.append((force_data[index+n//2] - force_data[index-n//2])/(</span>
    <span class="c1">#             time_data[index+n//2] - time_data[index-n//2]))</span>
    <span class="c1">#     derivation = np.array(derivation)</span>
    <span class="c1">#     return derivation</span>

    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.delta_t"><a class="viewcode-back" href="../../../otanalysis.model.html#otanalysis.model.curve.Curve.delta_t">[docs]</a>    <span class="k">def</span> <span class="nf">delta_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculation of the delta t on the whole curve</span>

<span class="sd">        :return:</span>
<span class="sd">            delta_t: float</span>
<span class="sd">                time variation on the whole curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">delta_t</span> <span class="o">+=</span> <span class="n">segment</span><span class="o">.</span><span class="n">real_time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">delta_t</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, GNU GENERAL PUBLIC LICENSE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>